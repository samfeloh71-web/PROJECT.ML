{% extends "base.html" %}

{% block title %}Upload Dataset - Market Lens AI{% endblock %}

{% block content %}
<style>
    /* Animated gradient background */
    .animated-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(45deg, #050816, #0a1128, #1a0b2e, #16213e);
        background-size: 400% 400%;
        animation: gradientShift 15s ease infinite;
        z-index: -5;
    }

    @keyframes gradientShift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    /* Glow effects */
    .glow-orb {
        position: fixed;
        border-radius: 50%;
        filter: blur(80px);
        opacity: 0.4;
        z-index: -4;
        pointer-events: none;
        animation: float 20s infinite ease-in-out;
    }

    .orb-1 {
        width: 500px;
        height: 500px;
        background: radial-gradient(circle, #6366f1 0%, transparent 70%);
        top: -200px;
        left: -200px;
        animation-delay: 0s;
    }

    .orb-2 {
        width: 400px;
        height: 400px;
        background: radial-gradient(circle, #ec4899 0%, transparent 70%);
        bottom: -150px;
        right: -150px;
        animation-delay: 5s;
    }

    .orb-3 {
        width: 350px;
        height: 350px;
        background: radial-gradient(circle, #8b5cf6 0%, transparent 70%);
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        animation-delay: 10s;
    }

    @keyframes float {
        0%, 100% {
            transform: translate(0, 0) scale(1);
        }
        33% {
            transform: translate(100px, -50px) scale(1.1);
        }
        66% {
            transform: translate(-50px, 100px) scale(0.9);
        }
    }

    /* Grid overlay */
    .grid-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: 
            linear-gradient(rgba(99, 102, 241, 0.03) 1px, transparent 1px),
            linear-gradient(90deg, rgba(99, 102, 241, 0.03) 1px, transparent 1px);
        background-size: 50px 50px;
        z-index: -3;
        pointer-events: none;
        animation: gridMove 20s linear infinite;
    }

    @keyframes gridMove {
        0% {
            transform: translate(0, 0);
        }
        100% {
            transform: translate(50px, 50px);
        }
    }

    /* 3D Canvas */
    #canvas-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -2;
    }

    /* Particle field */
    .particle-field {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        pointer-events: none;
    }

    .particle {
        position: absolute;
        background: linear-gradient(135deg, #6366f1, #ec4899);
        border-radius: 50%;
        animation: particleFloat 20s infinite ease-in-out;
        opacity: 0;
    }

    @keyframes particleFloat {
        0% {
            transform: translateY(100vh) translateX(0) scale(0);
            opacity: 0;
        }
        10% {
            opacity: 1;
        }
        90% {
            opacity: 1;
        }
        100% {
            transform: translateY(-100vh) translateX(100px) scale(1);
            opacity: 0;
        }
    }

    /* Main container */
    .upload-wrapper {
        position: relative;
        z-index: 1;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 40px 20px;
        perspective: 1000px;
    }

    .upload-container {
        width: 100%;
        max-width: 680px;
        animation: floatInScale 1.2s cubic-bezier(0.16, 1, 0.3, 1);
    }

    @keyframes floatInScale {
        from {
            opacity: 0;
            transform: translateY(50px) scale(0.9) rotateX(10deg);
        }
        to {
            opacity: 1;
            transform: translateY(0) scale(1) rotateX(0);
        }
    }

    .upload-card {
        background: rgba(15, 23, 42, 0.7);
        backdrop-filter: blur(40px) saturate(180%);
        border-radius: 32px;
        padding: 56px 48px;
        border: 1px solid rgba(255, 255, 255, 0.08);
        box-shadow: 
            0 30px 90px rgba(0, 0, 0, 0.7),
            0 0 0 1px rgba(255, 255, 255, 0.05) inset,
            0 0 80px rgba(99, 102, 241, 0.15);
        position: relative;
        overflow: hidden;
        transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .upload-card:hover {
        transform: translateY(-5px);
        box-shadow: 
            0 40px 110px rgba(0, 0, 0, 0.8),
            0 0 0 1px rgba(255, 255, 255, 0.1) inset,
            0 0 100px rgba(99, 102, 241, 0.25);
    }

    /* Animated border */
    .upload-card::before {
        content: '';
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: linear-gradient(45deg, 
            #6366f1, #8b5cf6, #ec4899, #f59e0b, #6366f1);
        background-size: 400%;
        border-radius: 32px;
        z-index: -1;
        animation: borderGlow 8s linear infinite;
        opacity: 0.5;
        filter: blur(8px);
    }

    @keyframes borderGlow {
        0%, 100% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
    }

    /* Inner glow effect */
    .upload-card::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 200px;
        background: radial-gradient(ellipse at top, rgba(99, 102, 241, 0.15) 0%, transparent 70%);
        pointer-events: none;
    }

    /* Header section */
    .upload-header {
        text-align: center;
        margin-bottom: 48px;
        position: relative;
        z-index: 1;
    }

    .upload-icon-wrapper {
        width: 88px;
        height: 88px;
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #ec4899 100%);
        border-radius: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 24px;
        box-shadow: 
            0 20px 60px rgba(99, 102, 241, 0.6),
            0 0 0 1px rgba(255, 255, 255, 0.1) inset;
        animation: logoFloat 3s ease-in-out infinite;
        font-size: 40px;
    }

    @keyframes logoFloat {
        0%, 100% {
            transform: translateY(0px) rotateY(0deg);
        }
        50% {
            transform: translateY(-10px) rotateY(5deg);
        }
    }

    .upload-title {
        font-size: 36px;
        font-weight: 800;
        font-family: 'Space Grotesk', sans-serif;
        background: linear-gradient(135deg, #fff 0%, #e0e7ff 50%, #c7d2fe 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 12px;
        letter-spacing: -1px;
    }

    .upload-subtitle {
        font-size: 16px;
        color: rgba(255, 255, 255, 0.6);
        line-height: 1.6;
        font-weight: 400;
    }

    .subtitle-highlight {
        color: #a78bfa;
        font-weight: 600;
    }

    /* Drop zone */
    .drop-zone {
        border: 2px dashed rgba(255, 255, 255, 0.2);
        border-radius: 20px;
        padding: 60px 40px;
        text-align: center;
        transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        cursor: pointer;
        background: rgba(255, 255, 255, 0.02);
        position: relative;
        z-index: 1;
        margin-bottom: 32px;
    }

    .drop-zone:hover {
        border-color: #6366f1;
        background: rgba(99, 102, 241, 0.05);
        transform: scale(1.02);
    }

    .drop-zone.drag-over {
        border-color: #a78bfa;
        background: rgba(99, 102, 241, 0.1);
        transform: scale(1.03);
    }

    .drop-zone-icon {
        font-size: 64px;
        margin-bottom: 20px;
        display: block;
    }

    .drop-zone-text {
        font-size: 18px;
        font-weight: 600;
        color: #fff;
        margin-bottom: 8px;
        font-family: 'Space Grotesk', sans-serif;
    }

    .drop-zone-subtext {
        font-size: 14px;
        color: rgba(255, 255, 255, 0.5);
        font-weight: 400;
    }

    .drop-zone-hint {
        font-size: 13px;
        color: #a78bfa;
        margin-top: 16px;
        font-weight: 500;
    }

    /* File input hidden */
    #file-input {
        display: none;
    }

    /* Selected file display */
    .selected-file {
        background: rgba(99, 102, 241, 0.1);
        border: 1px solid rgba(99, 102, 241, 0.3);
        border-radius: 16px;
        padding: 20px 24px;
        margin-bottom: 32px;
        display: none;
        align-items: center;
        gap: 16px;
        animation: slideUpFade 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        position: relative;
        z-index: 1;
    }

    @keyframes slideUpFade {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .file-icon {
        font-size: 32px;
    }

    .file-details {
        flex: 1;
    }

    .file-name {
        font-size: 16px;
        font-weight: 600;
        color: #fff;
        margin-bottom: 4px;
    }

    .file-size {
        font-size: 13px;
        color: rgba(255, 255, 255, 0.5);
    }

    .remove-file-btn {
        background: rgba(239, 68, 68, 0.2);
        border: 1px solid rgba(239, 68, 68, 0.4);
        color: #fca5a5;
        padding: 8px 12px;
        border-radius: 10px;
        cursor: pointer;
        font-size: 13px;
        font-weight: 600;
        transition: all 0.3s;
    }

    .remove-file-btn:hover {
        background: rgba(239, 68, 68, 0.3);
        transform: scale(1.05);
    }

    /* Upload button */
    .btn-upload {
        width: 100%;
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #ec4899 100%);
        background-size: 200% 200%;
        border: none;
        border-radius: 14px;
        padding: 18px 28px;
        font-weight: 700;
        color: white;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        position: relative;
        overflow: hidden;
        box-shadow: 0 12px 32px rgba(99, 102, 241, 0.4);
        letter-spacing: 0.5px;
        font-family: 'Space Grotesk', sans-serif;
        z-index: 1;
    }

    .btn-upload:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .btn-upload:not(:disabled):hover {
        box-shadow: 0 16px 48px rgba(99, 102, 241, 0.6);
        background-position: 100% 0;
        transform: translateY(-2px);
    }

    .btn-upload::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        transition: left 0.6s;
    }

    .btn-upload:hover::before {
        left: 100%;
    }

    /* Back to dashboard link */
    .back-link {
        text-align: center;
        margin-top: 28px;
        position: relative;
        z-index: 1;
    }

    .back-link a {
        color: #a78bfa;
        text-decoration: none;
        font-weight: 600;
        font-size: 15px;
        transition: all 0.3s;
        position: relative;
        display: inline-block;
        padding-bottom: 2px;
    }

    .back-link a::before {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 0;
        height: 2px;
        background: linear-gradient(90deg, #6366f1, #ec4899);
        transition: width 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .back-link a:hover {
        color: #c4b5fd;
        transform: translateX(-4px);
    }

    .back-link a:hover::before {
        width: 100%;
    }

    /* Alert */
    .alert {
        border-radius: 14px;
        padding: 16px 20px;
        font-size: 14px;
        margin-bottom: 28px;
        backdrop-filter: blur(10px);
        animation: alertSlide 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: 500;
        position: relative;
        z-index: 1;
    }

    .alert-success {
        border: 1px solid rgba(34, 197, 94, 0.3);
        background: rgba(34, 197, 94, 0.08);
        color: #86efac;
    }

    .alert-danger {
        border: 1px solid rgba(239, 68, 68, 0.3);
        background: rgba(239, 68, 68, 0.08);
        color: #fca5a5;
    }

    @keyframes alertSlide {
        from {
            opacity: 0;
            transform: translateY(-30px) scale(0.95);
        }
        to {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }

    .alert-close-btn {
        background: none;
        border: none;
        color: inherit;
        font-size: 22px;
        cursor: pointer;
        padding: 0;
        line-height: 1;
        transition: all 0.2s;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .alert-close-btn:hover {
        transform: rotate(90deg) scale(1.2);
    }

    /* Scan line effect */
    .scan-line {
        position: absolute;
        width: 100%;
        height: 2px;
        background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.6), transparent);
        animation: scan 4s linear infinite;
        pointer-events: none;
        z-index: 10;
    }

    @keyframes scan {
        0% {
            top: 0;
            opacity: 0;
        }
        50% {
            opacity: 1;
        }
        100% {
            top: 100%;
            opacity: 0;
        }
    }

    /* Loading state */
    .loading .btn-upload {
        pointer-events: none;
        opacity: 0.7;
    }

    .loading .btn-upload::after {
        content: '';
        position: absolute;
        width: 20px;
        height: 20px;
        right: 24px;
        top: 50%;
        transform: translateY(-50%);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
        to { transform: translateY(-50%) rotate(360deg); }
    }

    /* Responsive */
    @media (max-width: 768px) {
        .upload-card {
            padding: 44px 32px;
            border-radius: 28px;
        }

        .upload-title {
            font-size: 30px;
        }

        .drop-zone {
            padding: 48px 28px;
        }
    }

    @media (max-width: 480px) {
        .upload-wrapper {
            padding: 20px 12px;
        }

        .upload-card {
            padding: 36px 24px;
            border-radius: 24px;
        }

        .upload-title {
            font-size: 28px;
        }

        .upload-icon-wrapper {
            width: 72px;
            height: 72px;
            font-size: 36px;
        }

        .drop-zone {
            padding: 40px 20px;
        }

        .drop-zone-icon {
            font-size: 52px;
        }

        .drop-zone-text {
            font-size: 16px;
        }
    }
</style>

<!-- Background Elements -->
<div class="animated-bg"></div>
<div class="glow-orb orb-1"></div>
<div class="glow-orb orb-2"></div>
<div class="glow-orb orb-3"></div>
<div class="grid-overlay"></div>
<div id="canvas-container"></div>
<div class="particle-field" id="particleField"></div>

<!-- Upload Content -->
<div class="upload-wrapper">
    <div class="upload-container">
        <div class="upload-card">
            <div class="scan-line"></div>

            <!-- Header -->
            <div class="upload-header">
                <div class="upload-icon-wrapper">
                    üìä
                </div>
                <h1 class="upload-title">Upload Dataset</h1>
                <p class="upload-subtitle">
                    Upload your CSV file to unlock <span class="subtitle-highlight">AI-powered insights</span>
                </p>
            </div>

            <!-- Alert Messages -->
            {% if success %}
            <div class="alert alert-success" role="alert">
                <div>{{ success }}</div>
                <button type="button" class="alert-close-btn" onclick="this.parentElement.remove()">‚úï</button>
            </div>
            {% endif %}

            {% if error %}
            <div class="alert alert-danger" role="alert">
                <div>{{ error }}</div>
                <button type="button" class="alert-close-btn" onclick="this.parentElement.remove()">‚úï</button>
            </div>
            {% endif %}

            <!-- Upload Form -->
            <form method="POST" enctype="multipart/form-data" id="uploadForm">
                <!-- Drop Zone -->
                <div class="drop-zone" id="dropZone">
                    <span class="drop-zone-icon">üìÅ</span>
                    <div class="drop-zone-text">Drag & drop your CSV file here</div>
                    <div class="drop-zone-subtext">or click to browse</div>
                    <div class="drop-zone-hint">Supported format: .csv</div>
                </div>

                <!-- Hidden File Input -->
                <input type="file" id="file-input" name="file" accept=".csv" required>

                <!-- Selected File Display -->
                <div class="selected-file" id="selectedFile">
                    <span class="file-icon">üìÑ</span>
                    <div class="file-details">
                        <div class="file-name" id="fileName"></div>
                        <div class="file-size" id="fileSize"></div>
                    </div>
                    <button type="button" class="remove-file-btn" id="removeFileBtn">Remove</button>
                </div>

                <!-- Upload Button -->
                <button type="submit" class="btn-upload" id="uploadBtn" disabled>
                    Upload & Analyze
                </button>

                <!-- Back to Dashboard -->
                <div class="back-link">
                    <a href="{{ url_for('home') }}">‚Üê Back to Dashboard</a>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Three.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<script>
    // Three.js Scene Setup (Same as login page)
    const container = document.getElementById('canvas-container');
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
    
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    container.appendChild(renderer.domElement);

    // Create particle system
    const particleCount = 1000;
    const particlesGeometry = new THREE.BufferGeometry();
    const particlePositions = new Float32Array(particleCount * 3);
    const particleSpeeds = new Float32Array(particleCount);

    for (let i = 0; i < particleCount * 3; i += 3) {
        particlePositions[i] = (Math.random() - 0.5) * 50;
        particlePositions[i + 1] = (Math.random() - 0.5) * 50;
        particlePositions[i + 2] = (Math.random() - 0.5) * 50;
        particleSpeeds[i / 3] = Math.random() * 0.02 + 0.01;
    }

    particlesGeometry.setAttribute('position', new THREE.BufferAttribute(particlePositions, 3));

    const particlesMaterial = new THREE.PointsMaterial({
        color: 0x6366f1,
        size: 0.05,
        transparent: true,
        opacity: 0.6,
        blending: THREE.AdditiveBlending
    });

    const particleSystem = new THREE.Points(particlesGeometry, particlesMaterial);
    scene.add(particleSystem);

    // Create geometric shapes
    const shapes = [];
    const geometries = [
        new THREE.OctahedronGeometry(1, 0),
        new THREE.TetrahedronGeometry(1, 0),
        new THREE.IcosahedronGeometry(1, 0),
        new THREE.DodecahedronGeometry(1, 0)
    ];

    for (let i = 0; i < 20; i++) {
        const geometry = geometries[Math.floor(Math.random() * geometries.length)];
        const material = new THREE.MeshPhongMaterial({
            color: i % 3 === 0 ? 0x6366f1 : i % 3 === 1 ? 0x8b5cf6 : 0xec4899,
            wireframe: true,
            transparent: true,
            opacity: 0.2,
            emissive: i % 3 === 0 ? 0x6366f1 : i % 3 === 1 ? 0x8b5cf6 : 0xec4899,
            emissiveIntensity: 0.2
        });

        const mesh = new THREE.Mesh(geometry, material);
        mesh.position.set(
            (Math.random() - 0.5) * 30,
            (Math.random() - 0.5) * 30,
            (Math.random() - 0.5) * 30
        );
        mesh.rotation.set(
            Math.random() * Math.PI,
            Math.random() * Math.PI,
            Math.random() * Math.PI
        );
        const scale = Math.random() * 2 + 0.5;
        mesh.scale.set(scale, scale, scale);
        
        mesh.userData.rotationSpeed = {
            x: (Math.random() - 0.5) * 0.01,
            y: (Math.random() - 0.5) * 0.01,
            z: (Math.random() - 0.5) * 0.01
        };
        
        shapes.push(mesh);
        scene.add(mesh);
    }

    // Lights
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.3);
    scene.add(ambientLight);

    const pointLight1 = new THREE.PointLight(0x6366f1, 2, 100);
    pointLight1.position.set(15, 15, 15);
    scene.add(pointLight1);

    const pointLight2 = new THREE.PointLight(0xec4899, 2, 100);
    pointLight2.position.set(-15, -15, -15);
    scene.add(pointLight2);

    const pointLight3 = new THREE.PointLight(0x8b5cf6, 1.5, 100);
    pointLight3.position.set(0, 20, 0);
    scene.add(pointLight3);

    camera.position.z = 20;

    // Mouse interaction
    let mouseX = 0;
    let mouseY = 0;
    let targetX = 0;
    let targetY = 0;

    document.addEventListener('mousemove', (event) => {
        mouseX = (event.clientX / window.innerWidth) * 2 - 1;
        mouseY = -(event.clientY / window.innerHeight) * 2 + 1;
    });

    // Animation loop
    function animate() {
        requestAnimationFrame(animate);

        // Smooth mouse following
        targetX += (mouseX - targetX) * 0.05;
        targetY += (mouseY - targetY) * 0.05;

        // Rotate shapes
        shapes.forEach((shape) => {
            shape.rotation.x += shape.userData.rotationSpeed.x;
            shape.rotation.y += shape.userData.rotationSpeed.y;
            shape.rotation.z += shape.userData.rotationSpeed.z;
        });

        // Animate particle system
        particleSystem.rotation.y += 0.0005;
        const positions = particleSystem.geometry.attributes.position.array;
        for (let i = 0; i < positions.length; i += 3) {
            positions[i + 1] += particleSpeeds[i / 3];
            if (positions[i + 1] > 25) {
                positions[i + 1] = -25;
            }
        }
        particleSystem.geometry.attributes.position.needsUpdate = true;

        // Camera movement
        camera.position.x += (targetX * 5 - camera.position.x) * 0.05;
        camera.position.y += (targetY * 5 - camera.position.y) * 0.05;
        camera.lookAt(scene.position);

        // Animate lights
        const time = Date.now() * 0.001;
        pointLight1.position.x = Math.sin(time * 0.7) * 15;
        pointLight1.position.z = Math.cos(time * 0.7) * 15;
        pointLight2.position.x = Math.cos(time * 0.5) * 15;
        pointLight2.position.z = Math.sin(time * 0.5) * 15;

        renderer.render(scene, camera);
    }

    animate();

    // Window resize handler
    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });

    // Create floating particles in DOM
    const particleField = document.getElementById('particleField');
    for (let i = 0; i < 40; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        const size = Math.random() * 4 + 2;
        particle.style.width = size + 'px';
        particle.style.height = size + 'px';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 20 + 's';
        particle.style.animationDuration = (Math.random() * 15 + 15) + 's';
        particleField.appendChild(particle);
    }

    // File upload functionality
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('file-input');
    const selectedFile = document.getElementById('selectedFile');
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');
    const removeFileBtn = document.getElementById('removeFileBtn');
    const uploadBtn = document.getElementById('uploadBtn');
    const uploadForm = document.getElementById('uploadForm');

    // Click to browse
    dropZone.addEventListener('click', () => {
        fileInput.click();
    });

    // File input change
    fileInput.addEventListener('change', (e) => {
        handleFiles(e.target.files);
    });

    // Drag and drop
    dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.classList.add('drag-over');
    });

    dropZone.addEventListener('dragleave', () => {
        dropZone.classList.remove('drag-over');
    });

    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.classList.remove('drag-over');
        handleFiles(e.dataTransfer.files);
    });

    // Handle file selection
    function handleFiles(files) {
        if (files.length > 0) {
            const file = files[0];
            
            // Check if file is CSV
            if (!file.name.endsWith('.csv')) {
                alert('Please select a CSV file');
                return;
            }

            // Display file info
            fileName.textContent = file.name;
            fileSize.textContent = formatFileSize(file.size);
            selectedFile.style.display = 'flex';
            uploadBtn.disabled = false;
            dropZone.style.display = 'none';
        }
    }

    // Format file size
    function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
    }

    // Remove file
    removeFileBtn.addEventListener('click', () => {
        fileInput.value = '';
        selectedFile.style.display = 'none';
        dropZone.style.display = 'block';
        uploadBtn.disabled = true;
    });

    // Form submission
    uploadForm.addEventListener('submit', function(e) {
        uploadForm.classList.add('loading');
        uploadBtn.textContent = 'Uploading...';
    });

    // Card tilt effect
    const uploadCard = document.querySelector('.upload-card');
    uploadCard.addEventListener('mousemove', (e) => {
        const rect = uploadCard.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        const centerX = rect.width / 2;
        const centerY = rect.height / 2;
        
        const rotateX = (y - centerY) / 30;
        const rotateY = (centerX - x) / 30;
        
        uploadCard.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) translateY(-5px)`;
    });

    uploadCard.addEventListener('mouseleave', () => {
        uploadCard.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) translateY(0)';
    });
</script>

{% endblock %}
